## <a name="creating-key-vaults-for-your-applications"></a><span data-ttu-id="f80b1-101">Creación de almacenes de claves para sus aplicaciones</span><span class="sxs-lookup"><span data-stu-id="f80b1-101">Creating Key Vaults for your applications</span></span>

<span data-ttu-id="f80b1-102">Un buen procedimiento es dar a cada aplicación un almacén independiente para cada entorno de aplicación que use, como desarrollo, prueba y producción.</span><span class="sxs-lookup"><span data-stu-id="f80b1-102">Good practice is to give each application a separate vault for each deployment environment you use, such as development, test, and production.</span></span> <span data-ttu-id="f80b1-103">Puede ser conveniente compartir secretos entre aplicaciones, pero el impacto de que un atacante obtenga acceso de lectura a un almacén aumenta con el número de secretos del almacén.</span><span class="sxs-lookup"><span data-stu-id="f80b1-103">It may be convenient to share secrets across apps, but the impact of an attacker gaining read access to a vault increases with the number of secrets in the vault.</span></span>

> [!TIP]
> <span data-ttu-id="f80b1-104">Si usa los mismos nombres con los secretos de distintos entornos, la única configuración específica del entorno que tiene que cambiar en su aplicación es la dirección URL del almacén.</span><span class="sxs-lookup"><span data-stu-id="f80b1-104">If you use the same names for secrets across different environments, the only environment-specific configuration that has to change in your app is the vault URL.</span></span>

<span data-ttu-id="f80b1-105">La creación de un almacén no requiere ninguna configuración inicial.</span><span class="sxs-lookup"><span data-stu-id="f80b1-105">Creating a vault requires no initial configuration.</span></span> <span data-ttu-id="f80b1-106">La identidad del usuario se concede automáticamente al conjunto completo de permisos de administración de secretos y puede empezar a agregar secretos inmediatamente.</span><span class="sxs-lookup"><span data-stu-id="f80b1-106">Your user identity is automatically granted the full set of secret management permissions and you can start adding secrets immediately.</span></span> <span data-ttu-id="f80b1-107">Una vez que tiene un almacén, para agregar y administrar secretos puede usar cualquier interfaz administrativa de Azure, como Azure Portal, la CLI de Azure y Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="f80b1-107">Once you have a vault, adding and managing secrets can be done from any Azure administrative interface, including the Azure portal, the Azure CLI, and Azure PowerShell.</span></span> <span data-ttu-id="f80b1-108">Al configurar la aplicación para usar el almacén, deberá asignarle los permisos correctos; esto lo veremos en la siguiente unidad.</span><span class="sxs-lookup"><span data-stu-id="f80b1-108">When you set up your application to use the vault, you'll need to assign the correct permissions to it; we'll see that in the next unit.</span></span>

## <a name="vault-authentication-and-permissions"></a><span data-ttu-id="f80b1-109">Permisos y autenticación de almacén</span><span class="sxs-lookup"><span data-stu-id="f80b1-109">Vault authentication and permissions</span></span>

<span data-ttu-id="f80b1-110">La API de Azure Key Vault usa Azure Active Directory para autenticar usuarios y aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="f80b1-110">Azure Key Vault's API uses Azure Active Directory to authenticate users and applications.</span></span> <span data-ttu-id="f80b1-111">Las directivas de acceso del almacén se basan en *acciones* y se aplican en todo el almacén.</span><span class="sxs-lookup"><span data-stu-id="f80b1-111">Vault access policies are based on *actions*, and are applied across an entire vault.</span></span> <span data-ttu-id="f80b1-112">Por ejemplo, una aplicación con los permisos **Obtener** (leer valores secretos), **Lista** (enumerar los nombres de todos los secretos) y **Establecer** (crear o actualizar valores secretos) en un almacén puede crear secretos, enumerar todos los nombres de secretos y obtener y establecer todos los valores secretos de ese almacén.</span><span class="sxs-lookup"><span data-stu-id="f80b1-112">For example, an application with **Get** (read secret values), **List** (list names of all secrets), and **Set** (create or update secret values) permissions to a vault is able to create secrets, list all secret names, and get and set all secret values in that vault.</span></span>

<span data-ttu-id="f80b1-113">*Todas* las acciones realizadas en un almacén requieren autenticación y autorización, no hay ninguna manera de conceder algún tipo de acceso anónimo.</span><span class="sxs-lookup"><span data-stu-id="f80b1-113">*All* actions performed on a vault require authentication and authorization &mdash; there is no way to grant any kind of anonymous access.</span></span>

> [!TIP]
> <span data-ttu-id="f80b1-114">Al conceder acceso al almacén a desarrolladores y aplicaciones, conceda solo el conjunto mínimo de permisos necesarios.</span><span class="sxs-lookup"><span data-stu-id="f80b1-114">When granting vault access to developers and apps, grant only the minimum set of permissions needed.</span></span> <span data-ttu-id="f80b1-115">Las restricciones de permisos ayudan a evitar accidentes ocasionados por errores de código y reducen el impacto de credenciales robadas o código malintencionado insertado en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="f80b1-115">Permissions restrictions help avoid accidents caused by code bugs and reduce the impact of stolen credentials or malicious code injected into your app.</span></span>

<span data-ttu-id="f80b1-116">Normalmente, los desarrolladores solo necesitan los permisos **Obtener** y **Lista** para un almacén de entorno de desarrollo.</span><span class="sxs-lookup"><span data-stu-id="f80b1-116">Developers will usually only need **Get** and **List** permissions to a development-environment vault.</span></span> <span data-ttu-id="f80b1-117">Un desarrollador principal o jefe necesitará permisos completos para el almacén para cambiar y agregar secretos cuando sea necesario.</span><span class="sxs-lookup"><span data-stu-id="f80b1-117">A lead or senior developer will need full permissions to the vault to change and add secrets when necessary.</span></span> <span data-ttu-id="f80b1-118">Los permisos completos para los almacenes del entorno de producción se reservan normalmente para el personal de operaciones superior.</span><span class="sxs-lookup"><span data-stu-id="f80b1-118">Full permissions to production-environment vaults are typically reserved for senior operations staff.</span></span>

<span data-ttu-id="f80b1-119">Para las aplicaciones, normalmente solo se requieren los permisos **Obtener**.</span><span class="sxs-lookup"><span data-stu-id="f80b1-119">For apps, typically only **Get** permissions are required.</span></span> <span data-ttu-id="f80b1-120">Algunas aplicaciones pueden requerir **Lista** según cómo se implemente la aplicación.</span><span class="sxs-lookup"><span data-stu-id="f80b1-120">Some apps may require **List** depending on the way the app is implemented.</span></span> <span data-ttu-id="f80b1-121">La aplicación que implementaremos en el ejercicio de este módulo requiere el permiso **Lista** debido a la técnica que usa para leer los secretos del almacén.</span><span class="sxs-lookup"><span data-stu-id="f80b1-121">The app we'll implement in this module's exercise requires the **List** permission because of the technique it uses to read secrets from the vault.</span></span>

## <a name="exercise"></a><span data-ttu-id="f80b1-122">Ejercicio</span><span class="sxs-lookup"><span data-stu-id="f80b1-122">Exercise</span></span>

<span data-ttu-id="f80b1-123">Dadas todas las dificultades que ha estado teniendo la empresa con los secretos de aplicación, la dirección le ha pedido que cree una pequeña aplicación de inicio para mostrar a los demás desarrolladores el camino adecuado.</span><span class="sxs-lookup"><span data-stu-id="f80b1-123">Given all the trouble the company's been having with application secrets, management has asked you to create a small starter app to set the other developers on the right path.</span></span> <span data-ttu-id="f80b1-124">La aplicación debe demostrar procedimientos recomendados para administrar secretos de la manera más simple y segura posible.</span><span class="sxs-lookup"><span data-stu-id="f80b1-124">The app needs to demonstrate best practices for managing secrets as simply and securely as possible.</span></span>

<span data-ttu-id="f80b1-125">Para empezar, creará un almacén y almacenará un secreto.</span><span class="sxs-lookup"><span data-stu-id="f80b1-125">To start, you'll create a vault and store one secret.</span></span>

### <a name="create-a-resource-group"></a><span data-ttu-id="f80b1-126">Crear un grupo de recursos</span><span class="sxs-lookup"><span data-stu-id="f80b1-126">Create a resource group</span></span>

<span data-ttu-id="f80b1-127">Cree un grupo de recursos llamado `keyvault-exercise-group` para todos los recursos de este ejercicio.</span><span class="sxs-lookup"><span data-stu-id="f80b1-127">Create a resource group called `keyvault-exercise-group` for all of the resources in this exercise.</span></span> <span data-ttu-id="f80b1-128">Al final de este módulo, eliminaremos este grupo de recursos para limpiar todo de una vez.</span><span class="sxs-lookup"><span data-stu-id="f80b1-128">At the end of this module, we'll be deleting this resource group to clean up everything at once.</span></span> <span data-ttu-id="f80b1-129">Vamos a usar `eastus` como la ubicación para todo lo que hagamos en este ejercicio.</span><span class="sxs-lookup"><span data-stu-id="f80b1-129">We'll use `eastus` as the location for everything in this exercise.</span></span>

<span data-ttu-id="f80b1-130">Use el terminal de Azure Cloud Shell de la derecha para ejecutar el siguiente comando de la CLI de Azure.</span><span class="sxs-lookup"><span data-stu-id="f80b1-130">Use the Azure Cloud Shell terminal on the right to run the following Azure CLI command.</span></span> <span data-ttu-id="f80b1-131">Este comando crea el grupo de recursos en su suscripción.</span><span class="sxs-lookup"><span data-stu-id="f80b1-131">This will create the resource group in your subscription.</span></span>

```azurecli
az group create --name keyvault-exercise-group --location eastus
```

### <a name="create-the-vault-and-store-the-secret-in-it"></a><span data-ttu-id="f80b1-132">Creación del almacén y almacenamiento en él del secreto</span><span class="sxs-lookup"><span data-stu-id="f80b1-132">Create the vault and store the secret in it</span></span>

<span data-ttu-id="f80b1-133">A continuación, crearemos el almacén y almacenaremos en él el secreto.</span><span class="sxs-lookup"><span data-stu-id="f80b1-133">Next, we'll create the vault and store our secret in it.</span></span>

<span data-ttu-id="f80b1-134">**Los nombres de Key Vault deben ser globalmente únicos, por lo que debe elegir un nombre único**.</span><span class="sxs-lookup"><span data-stu-id="f80b1-134">**Key Vault names must be globally unique, so you'll need to pick a unique name**.</span></span> <span data-ttu-id="f80b1-135">Los nombres de almacén deben tener entre 3 y 24 caracteres y contener solo caracteres alfanuméricos y guiones.</span><span class="sxs-lookup"><span data-stu-id="f80b1-135">Vault names must be 3-24 characters long and contain only alphanumeric characters and dashes.</span></span>

```azurecli
az keyvault create --name <your-unique-vault-name> --resource-group keyvault-exercise-group --location eastus
```

<span data-ttu-id="f80b1-136">Cuando haya terminado, verá una salida JSON que describe el nuevo almacén.</span><span class="sxs-lookup"><span data-stu-id="f80b1-136">When it finishes, you'll see JSON output describing the new vault.</span></span>

<span data-ttu-id="f80b1-137">Ahora, agregue el secreto: nuestro secreto se denominará **SecretPassword** con un valor de **reindeer_flotilla**.</span><span class="sxs-lookup"><span data-stu-id="f80b1-137">Now add the secret: our secret will be named **SecretPassword** with a value of **reindeer_flotilla**.</span></span>

```azurecli
az keyvault secret set --name SecretPassword --value open_sesame --vault-name <your-unique-vault-name>
```

<span data-ttu-id="f80b1-138">Anote el nombre del almacén &mdash;, pronto lo necesitará de nuevo.</span><span class="sxs-lookup"><span data-stu-id="f80b1-138">Make a note of the vault name &mdash; you'll be needing it again soon.</span></span>

<span data-ttu-id="f80b1-139">En un momento escribiremos el código de nuestra aplicación, pero primero debemos saber un poco cómo vamos a autenticarla en un almacén.</span><span class="sxs-lookup"><span data-stu-id="f80b1-139">We'll write the code for our application shortly, but first we need to learn a little bit about how our app is going to authenticate to a vault.</span></span>